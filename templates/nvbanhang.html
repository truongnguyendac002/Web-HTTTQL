<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Representative Dashboard</title>
    <style>
        .product-list {
            margin-top: 20px;
        }
        .product-item {
            margin-bottom: 10px;
        }
        .payment-button {
            margin-top: 20px;
        }
        .total-amount {
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Welcome, Sales Representative!</h1>
    <p>This is the sales representative's dashboard.</p>
    <a href="{{ url_for('logout') }}">Logout</a>

    <div>
        <label for="product-code">Enter Product Code:</label>
        <input type="text" id="product-code">
        <button onclick="addProduct()">Add Product</button>
    </div>

    <div class="product-list" id="product-list">
        <h2>Product List</h2>
    </div>

    <div class="customer-phone">
        <label for="customer-phone">Enter Customer Phone:</label>
        <input type="text" id="customer-phone">    
    </div>
  <div class="">
    <span class="total-amount" id="total-amount-info">Total amount to be paid: <span id="total-amount"></span> Đ</span>
  </div>
    <!-- Hiển thị tổng tiền -->

    <!-- Nút thanh toán -->
    <button class="payment-button" onclick="processPayment()">Proceed to Payment</button>

    <script>
        // Khởi tạo biến tổng tiền
        let totalAmount = 0;

        async function addProduct() {
            const productCode = document.getElementById('product-code').value;
            if (productCode) {
                const response = await fetch('/add_product', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ product_code: productCode }),
                });
                const data = await response.json();
                if (data.success) {
                    const product = data.product;
                    const productList = document.getElementById('product-list');
                    const productItem = document.createElement('div');
                    productItem.className = 'product-item';
                    productItem.textContent = `Product Code: ${product.maDienThoai}, Name: ${product.tenDienThoai}, Price: ${product.giaTien} Đ`;
                    productList.appendChild(productItem);
                    document.getElementById('product-code').value = '';
                    
                    // Cập nhật tổng tiền
                    totalAmount += product.giaTien;
                    document.getElementById('total-amount').textContent = totalAmount;
                    // Hiển thị dòng thông tin tổng tiền
                    document.getElementById('total-amount-info').style.display = 'block';
                } else {
                    alert(data.message);
                }
            }
        }

        async function processPayment() {
            const customerPhone = document.getElementById('customer-phone').value;
            const response = await fetch('/process_payment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ customer_phone: customerPhone }),
            });
            const data = await response.json();
            if (data.success) {
                alert('Total amount to be paid: ' + data.total_amount + " Đ");
            } else {
                alert(data.message);
            }
        }
    </script>
</body>
</html>
